---
title: 软件设计之道-那些值得借鉴的实践案例
date: 2017-11-14 14:04:11
tags: [读书笔记]
categories: 技术
---

书摘
<!-- more -->

# 工程实践
##  第3章 代码评审
### 代码评审关注点
需求理解偏差
架构一致性，除正确性以外的其他属性
设计思路的盲点，场景缺失
接口核对
可测试性
简洁性
后期难以检测的问题
### 自动化测试的关注点
人对计算机运算结果的预期错误
逻辑复杂度高的功能
容易受影响，需要频繁回归的功能

### 设计模式
创新模式-5， 结构模式-7 行为模式-11
> 熟练掌握类图，类与类之间的关系
> 掌握每种模式的构成件以及构成件之间的相互关系
> 识别每种模式中稳定部分和变化部分，每种模式应用的场景和局限
> 亲手应用模式，编写代码

### DDD领域驱动开发

## 第6 百度外卖物流智能调度
数据建模
对于多目标动态优化问题，采取逐层建模的方式降低复杂度。
降维：通用的参数变量，需要在底层作为基础约束条件经行采集
特化：多变的场景变量，在高层作为调优参数进行优化

场景优化：商圈 城市 时段 天气 。价格 -->          场景调参  -- 最优配送骑士及路径
动态规划：空间开销函数，时间开销，惩罚函数     --> 函数建模  -- 多项函数分值
约束条件：商户 用户 骑士，订单（起止时间 地点）  --> 数据采集 -- 试试场景下的约束变量
## 第7 当当用户画像
## 第8 当当推荐团队机器学习
总结：
1. 重视学习模型的同时 重视整体系统
2. 正确认识并充分利用可视化分析工具
3. 算法优势与人工经验知识相结合
4. 重视系统结构，周期性重构
5. 重视团队完整性建设，团队无短板
6. 重视工具和数据的抽象和重用
7. 重视流程，项目推进方法

# 互联网高可用架构变迁

## 第11 魅族应用商店服务端架构实践
### 第一代架构
服务器集群： LVS（双备） -》 nginx -》 jetty
使用缓存： 热点数据，高频数据 使用memcache
读写分离： 读多写少
CDN： 静态文件CDN

### 微服务架构
数据量增加 1000万用户 DB性能问题
单服务，并行开发低效

#### 开源产品
FASTDFS： 轻量级分布式文件系统，解决大数据量存储和高并发问题
Zookeeper：分布式应用程序协调服务，用于服务发现和调度
MetaQ: 淘宝java消息中间件
RPC： 自研 Kiev框架通信，基于Netty，串行化协议支持Hessian Protobuffer
分片：DB， Redis（基于Twemproxy的Redis集群方案， jedis做封装，监控，大Key限制保护）分片和集群

#### 微服务的改变途径
业务梳理，减少不必要的跨系统调用
业务解耦，功能模块化，服务独立部署
开发人员增加，微服务提升效率
使用zookeeper实现服务配置中心
接入层，服务层，存储层不允许跨层调用

#### 多级缓存到主动缓存
业务热点数据，读多写少
Task 实现排行，详情数据刷新到Redis
访问量大的查询接口，只访问Redis 不访问数据库
缓存策略从被动缓存到主动缓存
Mysql挂掉不影响用户浏览和下载等主要业务功能
添加JVM本地缓存，通过日志统计命中率高90%
动态页面静态化为文件，放到CDN
引入Android本地缓存，版本号方式验新

#### 数据库分库分表
按照当前用户10倍量评估
采用分库而非分表
用户hash分库
一台mysql实例可以同时安装100+数据库
数据库连接到实例，每次sql执行前 添加 use db
每台服务采用双master模式
按用户分库，用户记录在同一DB减少夸库访问。

#### 标准化
环境标准化： 标准化公用组件，运行环境，配置文件，文件目录，差异部分 提取配置平台
日志标准化：日志集中
跨系统日志遵从统一规范
单元测试覆盖80%

### 多机房架构
单机房无法容灾，扩展困难，用户无法就近接入

#### 用户流量调度
使用智能DNS

#### 多机房数据双向同步
binlog日志 主从数据库同步， 通过task刷新缓存 ，机房间通过联通电信双VPN线路
只有主DB写入，容错和重试
跨机房通过MQ进行数据传递，比较实时的更新缓存
Redis持久化到mysql

### 未来
异地多活，多点写入
基于大数据用户画像，推荐，筛选，内容甄别
个性化推荐，基于用户画像


## 第14 架构演化和业务增长的领悟
分治，解耦
> 引入队列
> 通过反转注入IOC
> 采用事件驱动，观察者模式，消息链模式
扩容
数据写瓶颈：
> 内存聚合，一定量后统一写入
> 采用 nosql技术
> 水平分/垂直分

计算瓶颈:
复杂数学模型，feature增加，运算力需求增加；
内存换时间，分布式计算，分级服务

存储瓶颈： nosql es

### 微服务
> 组件化
> 业务组织团队
> 服务就是产品
> 去中心化
> 基础设施自动化
> 容错设计
> 计划设计
> 服务质量保证

## 第15 Mico的朴素架构之旅
mysql作为主要的持久化存储， 大部分业务落在mysql，采用主从拓扑，按业务分库；（从用来读）
Mogodb 文件系统使用GridFS； 使用GraphicsMagick js binding 处理图片压缩 缩略图

异步
拆分服务

对话场景：
发消息： 服务端写cache，同时更新消息协议中的redis，再写队列。 （落地，派发后台处理）
使用队列 实现 已送达，已阅读

socket server长连接 的水平扩展，会话双方不在同一实例， socket server通信也使用队列

### ELK 监控 RPC（Thrift）
### 云端
## 第16 Hulu全平台视频系统演进

## 第17 基于 perReq 提升微博图片访问质量

# 云计算和大数据

## 第18 云计算的核心业务系统建设（南天，戴敏）
复杂系统建设实践
1. 分离关注点
安全 并发 故障处理 伸缩 服务类型服务代理  服务管理 性能
实施角度: 概念设计 架构设计  总体设计

复杂系统引入云计算 soa 大数据很困难，不能 为了引入而引入
实践中，不能束缚于新技术 架构
分离主题
关注各个主题 自底向上分析 设计， 从主题推演架构设计
针对关键主题， 自底向上 采纳新技术， 调整策略
实施过程中 架构调整
2. 实施管理
关键： 整体规划能力  分解能力

## 第19  数据迁移 AWS

## 第21 东软 SaCa Aclome 云管理平台架构演进

产品交付角度： 无法按需交付，持续交付
产品生产： 难以做到 “规模化” 跨团队 跨组织合作
产品质量： 难以应对潜在性能问题
产品发展： 难以“可持续”产品改良

持续化交付： 产品按功能分割为多组件，根据需求提供必要的组件，组件装配技术快速交付； 
高可用： 自动管理监控，容器话 热部署 保证高可用

基于Dubbo分布式服务框架，提供高性能 透明化rpc远程调用 以及服务治理

微内核，缓存，菜单，日志，组织结构，权限，采集，分析 

## 第22 计算广告大数据核心技术 （卢亿雷）

高可靠： 多分存储，不丢失  -- HDFS
高可用： 7*24   --LVS 负载
高扩展：扩容服务 -- Hadoop
高性能：高并发 低延迟  -- Nginx Redis
高安全： IDC管理制度，分布式密钥管理  -- Kerberos SSL 公私钥 分布式密钥 程序沙箱隔离
高性价： -- Hadoop 分布式计算和存储
监控维护： 简单  -- Nagios Ganglia


